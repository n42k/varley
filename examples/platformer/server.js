const varley = require('varley')(this)
varley.module('chat')

varley.on('start', () => {
  varley.pub.world = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1],
    [1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,1],
    [1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1],
    [1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1],
    [1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1],
    [1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,1],
    [1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1],
    [1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1],
    [1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1],
    [1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,1],
    [1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1],
    [1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1],
    [1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1],
    [1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,1],
    [1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1],
    [1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1,1,1,1,6,1,1,1,1],
    [1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1],
    [1,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,1],
    [1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1,6,6,6,6,6,6,6,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
  ]
})

varley.on('connect', player => {
  player.PlatformerPlayer(farmer, {
    x: 384, y: 384, vx: 8, vy: 18, ax: 2, ay: 18,
    frameTime: 2, animations: [3, 2, 3, 2],
    world: varley.pub.world, tileSheet: farm,
    blocks: [
      S, S, S, A, S, A, A, A, A,
      S, S, S, A, S, A, A, A, A
    ]
  })
})

varley.on('press', (player, key) => {
  if(key !== 'SPACE')
    return

  let tileX = Math.round(player.x/32)
  let tileY = Math.round(player.y/32)

  if(tileY < 0 || tileY >= varley.pub.world.length ||
     tileX < 0 || tileX >= varley.pub.world[tileY].length)
     return

  varley.pub.world[tileY][tileX] = 15
})

varley.run({tickRate: 16})
